<!-- Products Grid -->
<div id="productosContainer" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
    {% for producto in productos %}
        <div class="product bg-white rounded-xl shadow-sm hover:shadow-lg transition-all duration-300 transform hover:-translate-y-1">
            <form class="product-form" id="product-form-{{ producto.id }}" action="" method="POST">
                <!-- Product Image -->
                <div class="w-full h-48 bg-gray-50 rounded-t-xl overflow-hidden">
                    <img 
                        src="{{ asset('img/productos/' ~ producto.id ~ '.webp') }}"
                        alt="{{ producto.nombre|default(producto.modelo|default('Producto')) }}"
                        class="w-full h-full object-contain"
                        onload="this.style.display='block'"
                        onerror="this.style.display='none'; this.parentElement.innerHTML='<div class=\'flex items-center justify-center h-full bg-gray-50\'><p class=\'text-gray-400 text-sm\'>Imagen no disponible</p></div>'"
                    />
                </div>
                
                <!-- Product Details -->
                <div class="p-6 space-y-4">
                    <!-- Brand -->
                    <div class="space-y-1">
                        <label class="text-xs font-medium text-gray-500 uppercase">Marca</label>
                        <input type="text" name="marca" class="w-full text-gray-900 font-medium bg-transparent border-0 editable" value="{{ producto.marca }}" readonly>
                    </div>

                    {% if producto.nombre is defined and producto.nombre %}
                        <div class="space-y-1">
                            <label class="text-xs font-medium text-gray-500 uppercase">Nombre</label>
                            <input type="text" name="nombre" class="w-full text-gray-900 bg-transparent border-0 editable" value="{{ producto.nombre }}" readonly>
                        </div>
                    {% endif %}

                    {% if producto.modelo is defined and producto.modelo %}
                        <div class="space-y-1">
                            <label class="text-xs font-medium text-gray-500 uppercase">Modelo</label>
                            <input type="text" name="modelo" class="w-full text-gray-900 bg-transparent border-0 editable" value="{{ producto.modelo }}" readonly>
                        </div>
                        <div class="space-y-1">
                            <label class="text-xs font-medium text-gray-500 uppercase">Tama√±o</label>
                            <input type="text" name="tamano" class="w-full text-gray-900 bg-transparent border-0 editable" value="{{ producto.tamano }}" readonly>
                        </div>
                        <div class="space-y-1">
                            <label class="text-xs font-medium text-gray-500 uppercase">Tipo</label>
                            <input type="text" name="tipo" class="w-full text-gray-900 bg-transparent border-0 editable" value="{{ producto.tipo }}" readonly>
                        </div>
                    {% endif %}

                    <div class="space-y-1">
                        <label class="text-xs font-medium text-gray-500 uppercase">ID</label>
                        <input type="text" name="id" class="w-full text-gray-900 bg-transparent border-0" value="{{ producto.id }}" readonly>
                    </div>

                    <div class="space-y-1">
                        <label class="text-xs font-medium text-gray-500 uppercase">UPC</label>
                        <input type="text" name="upc" class="w-full text-gray-900 bg-transparent border-0 editable" value="{{ producto.upc }}" readonly>
                    </div>

                    <div class="space-y-1">
                        <label class="text-xs font-medium text-gray-500 uppercase">Stock</label>
                        <input type="number" name="stock" class="w-full text-gray-900 bg-transparent border-0 editable" value="{{ producto.stock }}" readonly>
                    </div>

                    <!-- Price -->
                    <div class="pt-4 mt-4 border-t border-gray-100">
                        <input type="number" name="precio" class="w-full text-2xl font-bold text-black bg-transparent border-0 editable" value="{{ producto.precio }}" readonly>
                    </div>

                    <!-- Edit and Delete Buttons -->
                    <div class="flex justify-end items-center space-x-4 mt-4">
                        <button type="button" class="text-2xl hover:scale-110 transition-transform duration-300" onclick="toggleProductEdit('{{ producto.id }}')">
                            <span class="edit-icon">‚úèÔ∏è</span>
                            <span class="save-icon hidden">üíæ</span>
                        </button>
                        <button type="submit" class="edit-button px-6 py-2 duration-300 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-lg transition-colors hidden">
                            Guardar
                        </button>
                    </div>
                </div>
            </form>
            <form action="" method="POST" class="px-6 pb-4">
                <input type="hidden" name="id" value="{{ producto.id }}">
                <button type="button" onclick="confirmDelete('{{ producto.id }}')" class="text-2xl hover:scale-110 transition-transform duration-300 text-red-500">
                    üóëÔ∏è
                </button>
            </form>
        </div>
    {% endfor %}
</div>

<style>
.editing-mode {
    background-color: #f0f9ff;
    border-color: #3b82f6;
    box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1);
}

.editing-mode input:not([readonly]) {
    background-color: white !important;
    border: 1px solid #3b82f6 !important;
    padding: 0.25rem 0.5rem;
    border-radius: 0.375rem;
}

.edit-button {
    display: none;
}

.editing-mode .edit-button {
    display: inline-flex;
}
</style>

<script>
function toggleProductEdit(productId) {
    const form = document.getElementById(`product-form-${productId}`);
    const formContainer = form.closest('.product');
    const inputs = form.querySelectorAll('.editable');
    const editButton = form.querySelector('.edit-button');
    const editIcon = form.querySelector('.edit-icon');
    const saveIcon = form.querySelector('.save-icon');
    
    // Toggle la clase de modo edici√≥n
    formContainer.classList.toggle('editing-mode');
    
    // Toggle iconos
    editIcon.classList.toggle('hidden');
    saveIcon.classList.toggle('hidden');
    
    inputs.forEach(input => {
        input.readOnly = !input.readOnly;
        
        // A√±adir focus al primer input cuando se entra en modo edici√≥n
        if (!input.readOnly) {
            input.focus();
        }
    });
    
    // Toggle el bot√≥n de guardar
    editButton.classList.toggle('hidden');
}

function confirmDelete(productId) {
    if (window.confirm('¬øEst√° seguro que desea eliminar este producto?')) {
        const form = document.querySelector(`form[action="{{ path('deleteProduct') }}"] input[value="${productId}"]`).closest('form');
        form.submit();
    }
}
</script>