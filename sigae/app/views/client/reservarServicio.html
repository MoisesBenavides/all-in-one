<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Reserva de Servicio | AIO</title>
      <link rel="stylesheet" href="../../../css/styles.css">
      <link rel="icon" type="image/x-icon" href="../../../ico/logo-positivo.ico">
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
   </head>
   <header class=" w-screen">
      <link rel="stylesheet" href="../../../css/styles.css">
      <div class="container mx-auto px-4 py-4">
          <div class="relative flex flex-col md:flex-row justify-between items-center">
              
              <!-- Hamburguesa (visible solo en móviles) - Posicionada en la esquina superior izquierda -->
              <div class="absolute top-2 left-4 md:hidden">
                  <button id="hamburger" class="text-black focus:outline-none">
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" />
                      </svg>
                  </button>
              </div>
  
              <!-- Logo -->
              <div class="w-40 h-auto mb-4 md:mb-0 mx-auto md:mx-0">
                  <!-- Presionar logo para volver al home del cliente (href) -->
                  <img href="../../../index.php?action=home" class="w-full h-auto" src="../../../img/AIO Positivo.png" alt="AIO Logo" />
              </div>
  
              <!-- Navegación - visible solo en pantallas medianas y grandes -->
              <nav class="hidden md:flex flex-wrap justify-center md:justify-end space-x-2 md:space-x-4">
                  <a href="../client/serviciosMecanicos.html" class="text-black text-xs sm:text-sm md:text-lg lg:text-xl font-bold ">Servicios</a>
                  <a href="#" class="text-black text-xs sm:text-sm md:text-lg lg:text-xl font-bold ">AIO Parking</a>
                  <a href="#" class="text-black text-xs sm:text-sm md:text-lg lg:text-xl font-bold ">Repuestos y accesorios</a>
                  <a href="#" class="text-black text-xs sm:text-sm md:text-lg lg:text-xl font-bold ">FAQ</a>
              </nav>
  
              <!-- User icon - Alineado a la derecha en móviles -->
              <div class="absolute top-2 right-4 md:static">
                  <img class="w-10 h-10" src="../../../img/user.png" alt="User">
              </div>
          </div>
  
          <!-- Menú hamburguesa desplegable (oculto por defecto) -->
          <nav id="mobileMenu" class="hidden md:hidden mt-4 space-y-2">
              <a href="../client/serviciosMecanicos.html" class="block text-black text-sm font-bold ">Servicios</a>
              <a href="#" class="block text-black text-sm font-bold ">AIO Parking</a>
              <a href="#" class="block text-black text-sm font-bold ">Mis reservas</a>
              <a href="#" class="block text-black text-sm font-bold ">Repuestos y accesorios</a>
              <a href="#" class="block text-black text-sm font-bold ">FAQ</a>
          </nav>
      </div>
  
      <script>
          // Lógica del menú hamburguesa
          const hamburger = document.getElementById('hamburger');
          const mobileMenu = document.getElementById('mobileMenu');
  
          hamburger.addEventListener('click', () => {
              mobileMenu.classList.toggle('hidden');
          });
      </script>
         <script>
          const dropdownButton = document.getElementById('dropdownButton');
          const dropdownMenu = document.getElementById('dropdownMenu');
          const selectedOption = document.getElementById('selectedOption');
          const options = document.querySelectorAll('.option');
          const hiddenInput = document.getElementById('selectedVehicleType');
          const arrow = dropdownButton.querySelector('svg');
          const priceInfo = document.getElementById('priceInfo');
  
          dropdownButton.addEventListener('click', () => {
              dropdownMenu.classList.toggle('hidden');
              arrow.classList.toggle('rotate-180');
          });
  
          options.forEach(option => {
              option.addEventListener('click', () => {
                  selectedOption.textContent = option.textContent;
                  hiddenInput.value = option.getAttribute('data-value');
                  dropdownMenu.classList.add('hidden');
                  arrow.classList.remove('rotate-180');
  
                  // Mostrar el precio por hora
                  const price = option.getAttribute('data-price');
                  priceInfo.textContent = `Precio por hora: ${price} pesos`;
                  priceInfo.classList.remove('hidden');
              });
          });
  
          // Cerrar el menú si se hace clic fuera de él
          window.addEventListener('click', (e) => {
              if (!dropdownButton.contains(e.target) && !dropdownMenu.contains(e.target)) {
                  dropdownMenu.classList.add('hidden');
                  arrow.classList.remove('rotate-180');
              }
          });
      </script>
  </header>
   <body>
      <main class="container mx-auto px-4 py-8">
         <div class="max-w-3xl mx-auto space-y-12">
            <form id="servicioForm" action="index.php?action=doBookService" method="POST" class="w-full max-w-[340px] mx-auto">
               <section>
                  <h2 class="text-center text-black text-2xl font-semibold mb-4 bg-neutral-200 rounded-[5px] border border-black py-2">Ingrese la fecha</h2>
                  <div class="w-full max-w-[340px] mx-auto">
                     <input type="datetime-local" name= "fecha_inicio" class="w-full h-[60px] px-[22px] py-3.5 bg-white rounded-[10px] border border-[#161212] text-center text-black text-xl font-semibold">
                  </div>
               </section>
               <section>
                  <h2 class="text-center text-black text-2xl font-semibold mb-4 bg-neutral-200 rounded-[5px] border border-black py-2">Seleccione el servicio</h2>
                  <div class="relative mb-2">
                     <div id="dropdownButton1" class="w-full h-[60px] px-[22px] py-3.5 bg-white rounded-[10px] border border-[#161212] flex justify-between items-center cursor-pointer">
                        <div id="selectedOption1" class="text-center text-black text-xl font-semibold">Categoría</div>
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="w-6 h-6 transition-transform duration-300">
                           <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                        </svg>
                     </div>
                     <div id="dropdownMenu1" class="absolute z-10 right-0 top-0 mt-12 w-48 bg-white rounded-lg border border-[#161212] shadow-lg hidden">
                        <div class="py-1">
                           <div class="option cursor-pointer px-[22px] py-3.5 hover:bg-gray-100" data-value="alineacion">Alineación</div>
                           <div class="option cursor-pointer px-[22px] py-3.5 hover:bg-gray-100" data-value="balanceo">Balanceo</div>
                           <div class="option cursor-pointer px-[22px] py-3.5 hover:bg-gray-100" data-value="neumaticos">Servicios neumáticos</div>
                           <div class="option cursor-pointer px-[22px] py-3.5 hover:bg-gray-100" data-value="diagnostico">Diagnóstico</div>
                           <div class="option cursor-pointer px-[22px] py-3.5 hover:bg-gray-100" data-value="completo">Servicio completo</div>
                        </div>
                     </div>
                  </div>
                  <input type="hidden" id="selectedServiceType" name="categoriaServicio" value="">
               </section>
               <section>
                  <div class="relative mb-2">
                     <div id="dropdownButton2" class="w-full h-[60px] px-[22px] py-3.5 bg-white rounded-[10px] border border-[#161212] flex justify-between items-center cursor-pointer">
                        <div id="selectedOption2" class="text-center text-black text-xl font-semibold">Tipo</div>
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="w-6 h-6 transition-transform duration-300">
                           <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                        </svg>
                     </div>
                     <div id="dropdownMenu2" class="absolute z-10 right-0 top-0 mt-12 w-48 bg-white rounded-lg border border-[#161212] shadow-lg hidden">
                        <div id="tipoServicioOptions" class="py-1">
                           <!-- Options will be dynamically populated based on the selected service -->
                        </div>
                     </div>
                  </div>
                  <input type="hidden" id="selectedServiceSubtype" name="tipoServicio" value="">
               </section>
               <section>
                  <h2 class="text-center text-black text-2xl font-semibold mb-4 bg-neutral-200 rounded-[5px] border border-black py-2">Ingrese el tipo de vehículo</h2>
                  <div class="relative mb-2">
                     <div id="dropdownButtonAuto" class="w-full h-[60px] px-[22px] py-3.5 bg-white rounded-[10px] border border-[#161212] flex justify-between items-center cursor-pointer">
                        <div id="selectedOptionAuto" class="text-center text-black text-xl font-semibold">Tipo</div>
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="w-6 h-6 transition-transform duration-300">
                           <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                        </svg>
                     </div>
                     <div id="dropTipoVehiculo" class="absolute z-10 right-0 top-0 mt-12 w-48 bg-white rounded-lg border border-[#161212] shadow-lg hidden">
                        <div class="py-1">
                           <div class="option cursor-pointer px-[22px] py-3.5 hover:bg-gray-100" data-value="moto" data-price="100">Moto</div>
                           <div class="option cursor-pointer px-[22px] py-3.5 hover:bg-gray-100" data-value="camioneta" data-price="250">Camioneta</div>
                           <div class="option cursor-pointer px-[22px] py-3.5 hover:bg-gray-100" data-value="auto" data-price="200">Auto</div>
                           <div class="option cursor-pointer px-[22px] py-3.5 hover:bg-gray-100" data-value="camion" data-price="300">Pequeño camión</div>
                           <div class="option cursor-pointer px-[22px] py-3.5 hover:bg-gray-100" data-value="utilitario" data-price="300">Pequeño utilitario</div>
                        </div>
                     </div>
                  </div>
                  <input type="hidden" id="vehiculoElegido" name="tipoVehiculo" value="">
               </section>
               <script>
                  // Dropdown functionality for vehicle type selection
                  const dropdownButtonAuto = document.getElementById('dropdownButtonAuto');
                  const dropdownMenuAuto = document.getElementById('dropTipoVehiculo');
                  const selectedOptionAuto = document.getElementById('selectedOptionAuto');
                  const selectedVehicleType = document.getElementById('vehiculoElegido');
                  
                  dropdownButtonAuto.addEventListener('click', () => {
                      dropdownMenuAuto.classList.toggle('hidden');
                  });
                  
                  const optionsAuto = document.querySelectorAll('#dropTipoVehiculo .option');
                  optionsAuto.forEach(option => {
                      option.addEventListener('click', () => {
                          selectedOptionAuto.textContent = option.textContent;
                          selectedVehicleType.value = option.dataset.value;
                          dropdownMenuAuto.classList.add('hidden');
                      });
                  });
               </script>
               <section>
                  <h2 class="text-center text-black text-2xl font-semibold mb-4 bg-neutral-200 rounded-[5px] border border-black py-2">Tus vehículos</h2>
                  <div class="relative w-full max-w-[340px] mx-auto">
                     <select id="vehiculosDropdown" class="w-full h-[60px] px-[22px] py-3.5 bg-white rounded-[10px] border border-[#161212] text-center text-black text-xl font-semibold">
                        <option value="">Selecciona un vehículo</option>
                        <!-- Vehicle options will be inserted here -->
                     </select>
                  </div>
               </section>
               <div class="h-[52px] relative  ">
                  <!--INPUT PARA MATRICULA-->
                  <input id="matricula" name="matricula" type="text" placeholder="O registra ya con Matrícula" class="space-x-6  p-2 w-[340px] h-[50px]  text-[#2f353c] text-[22px] font-normal   tracking-wide bg-white rounded-md border border-[#2f353c]   text-left">
               </div>
               <section class="text-center"></section>
               <!--Continuar-->
               <button type="submit" class="w-full max-w-[340px] h-[62px] px-7 py-2.5 bg-[#950d03] rounded-lg text-neutral-50 text-[32px] font-bold leading-[51.78px]">Continuar</button>
               </section>
            </form>
         </div>
      </main>
      <script>
         // Dropdown functionality for service selection
         const dropdownButton1 = document.getElementById('dropdownButton1');
         const dropdownMenu1 = document.getElementById('dropdownMenu1');
         const selectedOption1 = document.getElementById('selectedOption1');
         const selectedServiceType = document.getElementById('selectedServiceType');
         
         dropdownButton1.addEventListener('click', () => {
             dropdownMenu1.classList.toggle('hidden');
         });
         
         const options1 = document.querySelectorAll('#dropdownMenu1 .option');
         options1.forEach(option => {
             option.addEventListener('click', () => {
                 selectedOption1.textContent = option.textContent;
                 selectedServiceType.value = option.dataset.value;
                 dropdownMenu1.classList.add('hidden');
                 updateServiceSubtypes(option.dataset.value);
             });
         });
         
         // Dropdown functionality for service subtype
         const dropdownButton2 = document.getElementById('dropdownButton2');
         const dropdownMenu2 = document.getElementById('dropdownMenu2');
         const selectedOption2 = document.getElementById('selectedOption2');
         const selectedServiceSubtype = document.getElementById('selectedServiceSubtype');
         const tipoServicioOptions = document.getElementById('tipoServicioOptions');
         
         dropdownButton2.addEventListener('click', () => {
             dropdownMenu2.classList.toggle('hidden');
         });
         
         function updateServiceSubtypes(serviceType) {
            const subtypes = {
                 alineacion: ['A01', 'A02', 'A03'],
                 balanceo: ['B01', 'B02', 'B03', 'B04'],
                 neumaticos: ['N01', 'N02', 'N03', 'N04'],
                 diagnostico: ['D01'],
                 completo: ['SVC']
             };
         
             tipoServicioOptions.innerHTML = '';
             subtypes[serviceType].forEach(subtype => {
                 const div = document.createElement('div');
                 div.className = 'option cursor-pointer px-[22px] py-3.5 hover:bg-gray-100';
                 div.textContent = subtype;
                 div.addEventListener('click', () => {
                     selectedOption2.textContent = subtype;
                     selectedServiceSubtype.value = subtype;
                     dropdownMenu2.classList.add('hidden');
                 });
                 tipoServicioOptions.appendChild(div);
             });
         
             // Reset the subtype selection
             selectedOption2.textContent = 'Tipo';
             selectedServiceSubtype.value = '';
         }
         
         // Function to load vehicles
         
         // ...
         
         
      </script>
      <!--ESTE SCRIPT DE DEBAJO FUNCIONA, LO PROBE CON UN ARCHIVO DE PRUEBA DE PHP EN MI CARPETA www-->
      <script>
         function cargarMisVehiculos() {
            $.ajax({
               url: '../../controllers/controladorCliente.php', // Ajusta la ruta correcta a tu controlador
               type: 'POST',
               data: { action: 'cargarMisVehiculosAjax' }, // Enviar parámetro de acción
               dataType: 'json',  // Indicamos que esperamos un objeto JSON como respuesta
               success: function(response) {
                     var vehiculosDropdown = $('#vehiculosDropdown');
                     
                     // Limpiar las opciones previas
                     vehiculosDropdown.find('option:not(:first)').remove();
                     
                     if (response.error) {
                        console.error(response.error);
                     } else {
                        // Procesar cada vehículo en la respuesta JSON
                        response.forEach(function(vehiculo) {
                           var matricula = vehiculo.matricula;
                           var tipo = vehiculo.tipo;  // Asegúrate de que el campo 'tipo' exista en tu respuesta JSON
                           
                           // Agregar la opción al dropdown
                           vehiculosDropdown.append($('<option>', {
                                 value: matricula,
                                 text: matricula + ' - ' + tipo
                           }));
                        });
                     }
               },
               error: function(xhr, status, error) {
                     console.error('Error al cargar las matrículas:', error);
               }
            });
         }

         // Llamar la función cuando se carga la página
         $(document).ready(function() {
            cargarMisVehiculos();
         });

      </script>
      <script>
         document.getElementById('signup-form').addEventListener('submit', function(e) {
             e.preventDefault();
             
             fetch(this.action + '&' + new URLSearchParams(new FormData(this)))
                 .then(response => response.json())
                 .then(data => {
                     const errorContainer = document.getElementById('error-container');
                     const errorList = document.getElementById('error-list');
                     
                     errorList.innerHTML = '';
                     
                     if (data.success) {
                         window.location.href = 'index.php?action=home';
                     } else {
                         errorContainer.classList.remove('hidden');
                         data.errors.forEach(error => {
                             const li = document.createElement('li');
                             li.textContent = error;
                             errorList.appendChild(li);
                         });
         
                         // Debug information
                         console.log('Debug info:', data.debug);
                         const debugInfo = document.createElement('pre');
                         debugInfo.textContent = JSON.stringify(data.debug, null, 2);
                         errorList.appendChild(debugInfo);
                     }
                 })
                 .catch(error => {
                     console.error('Error:', error);
                 });
         });
      </script>
   </body>
   <iframe id="footer" class="h-[400px] w-screen" src="../../views/contents/footer.html"></iframe>
</html>