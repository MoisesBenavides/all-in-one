<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="description" content="AIO taller mecanico en montevideo, Estacionamiento 24 horas y mas">
    <meta name="keywords" content="Taller mecanico, taller mecanico montevideo, taller mecanico cerca de mi, estacionamiento 24 horas, venta de neumaticos">
    <meta name="author" content="All In One">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ asset('css/styles.css') }}">
    <link rel="icon" type="image/x-icon" href="{{ asset('ico/logo-positivo.ico') }}">
    <title>Elección de plaza | AIO</title>
    <style>
        @font-face {
            font-family: 'Teachers';
            src: url("{{ asset('font/Teachers-VariableFont_wght.ttf') }}");
            font-weight: normal;
            font-style: normal;
        }

        body,
        input,
        select,
        button,
        option {
            font-family: 'Teachers', sans-serif;
        }
    </style>
</head>
   <header class=" w-screen  ">
    <link rel="stylesheet" href="{{ asset('css/styles.css') }}">
    <div class="container bg-alternativo mx-auto px-4 py-4">
        <div class="relative flex flex-col md:flex-row justify-between items-center">
            
            <!-- Hamburguesa (visible solo en móviles) - Posicionada en la esquina superior izquierda -->
            <div class="absolute top-2 left-4 md:hidden">
                <button id="hamburger" class="text-black focus:outline-none">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" />
                    </svg>
                </button>
            </div>

            <!-- Logo -->
              <!-- Presionar logo para volver al home del cliente (href) -->
             <a href="{{ path('aioParking') }}">
            <div class="w-40 h-auto mb-4 md:mb-0 mx-auto md:mx-0">
                <img class="w-full h-auto" src="{{ asset('img/AIO Parking positivo.png') }}" alt="AIO Logo" />
            </div>
          </a>

            <!-- Navegación - visible solo en pantallas medianas y grandes -->
            <nav class="hidden md:flex flex-wrap justify-center md:justify-end space-x-2 md:space-x-4">
                <a href="{{ path('home') }}" class="text-black text-xs sm:text-sm md:text-lg lg:text-xl font-bold   ">All In One</a>
                <a href="{{ path('aioParkingBookSimple') }}" class="text-black text-xs sm:text-sm md:text-lg lg:text-xl font-bold   ">Reservar</a>
                <a href="{{ path('aioParkingBookLongTerm') }}" class="text-black text-xs sm:text-sm md:text-lg lg:text-xl font-bold   ">Reservar a largo plazo</a>
                <a href="#" class="text-black text-xs sm:text-sm md:text-lg lg:text-xl font-bold   ">Mis Reservas</a>
                <a href="{{ path('faq')}}" class="text-black text-xs sm:text-sm md:text-lg lg:text-xl font-bold   ">FAQ</a>
            </nav>

            <!-- User icon - Alineado a la derecha en móviles -->
            <div class="absolute top-2 right-4 md:static">
                <img class="w-10 h-10" src="{{ asset('img/user.png') }}" alt="User">
            </div>
        </div>

        <!-- Menú hamburguesa desplegable (oculto por defecto) -->
        <nav id="mobileMenu" class="hidden md:hidden mt-4 space-y-2">
            <a href="{{ path('aioParkingBookSimple') }}" class="block text-black text-sm font-bold   ">Reservar</a>
            <a href="{{ path('aioParkingBookLongTerm') }}" class="block text-black text-sm font-bold   ">Reservar a largo plazo</a>
            <a href="#" class="block text-black text-sm font-bold   ">Mis Reservas</a>
            <a href="{{ path('faq')}}" class="block text-black text-sm font-bold   ">FAQ</a>
        </nav>
    </div>

    <script>
        // Lógica del menú hamburguesa
        const hamburger = document.getElementById('hamburger');
        const mobileMenu = document.getElementById('mobileMenu');

        hamburger.addEventListener('click', () => {
            mobileMenu.classList.toggle('hidden');
        });
    </script>
       <script>
        const dropdownButton = document.getElementById('dropdownButton');
        const dropdownMenu = document.getElementById('dropdownMenu');
        const selectedOption = document.getElementById('selectedOption');
        const options = document.querySelectorAll('.option');
        const hiddenInput = document.getElementById('selectedVehicleType');
        const arrow = dropdownButton.querySelector('svg');
        const priceInfo = document.getElementById('priceInfo');

        dropdownButton.addEventListener('click', () => {
            dropdownMenu.classList.toggle('hidden');
            arrow.classList.toggle('rotate-180');
        });

        options.forEach(option => {
            option.addEventListener('click', () => {
                selectedOption.textContent = option.textContent;
                hiddenInput.value = option.getAttribute('data-value');
                dropdownMenu.classList.add('hidden');
                arrow.classList.remove('rotate-180');

                // Mostrar el precio por hora
                const price = option.getAttribute('data-price');
                priceInfo.textContent = `Precio por hora: ${price} pesos`;
                priceInfo.classList.remove('hidden');
            });
        });

        // Cerrar el menú si se hace clic fuera de él
        window.addEventListener('click', (e) => {
            if (!dropdownButton.contains(e.target) && !dropdownMenu.contains(e.target)) {
                dropdownMenu.classList.add('hidden');
                arrow.classList.remove('rotate-180');
            }
        });
    </script>
</header>
<body class="bg-white">
    <div class="w-full max-w-[1440px] px-4 py-8 mx-auto flex flex-col items-center gap-8">
        <div
            class="w-full max-w-[896px] h-[46px] px-4 py-2 bg-[#d9d9d9] rounded-[10px] border border-[#c5b8b8] flex justify-center items-center gap-2.5">
            <button id="decrementFloor" class="w-[30px] h-[30px] bg-gray-100 rounded-full flex items-center justify-center">&lt;</button>
            <div id="floorDisplay" class="text-center text-black text-base font-medium">Piso 1</div>
            <button id="incrementFloor" class="w-[30px] h-[30px] bg-gray-100 rounded-full flex items-center justify-center">&gt;</button>
        </div>
        <div class="w-full flex flex-col space-y-2 justify-center items-center text-sm">
            <p><strong>B1-20:</strong> Motos (solo primer piso)</p> 
            <p><strong>A1-50:</strong> Autos, camionetas y pequeños camiones (primer piso)</p> 
            <p><strong>C1-50:</strong> Autos, camionetas y pequeños camiones (segundo piso)</p>
        </div>
          
        <form id="parkingForm" action="respuesta.php" method="POST">
            <div id="parkingContainer"
                class="w-full max-w-[600px] h-auto min-h-[359px] p-4 pt-8 bg-white border border-black relative">
            <!-- Parking spots will be generated here -->
            </div>

            <input type="hidden" name="selectedSpots" id="selectedSpotsInput">
            <div class="w-full max-w-[388px] flex justify-center mt-4">
                <button type="submit" class="w-full max-w-[340px] h-[62px] px-7 py-2.5 bg-[#950d03] rounded-lg text-neutral-50 text-[32px] font-bold leading-[51.78px]">
                    Continuar
                </button>
            </div>
        </form>
    </div>
    <script>
let puestosOcupados = [];
let selectedSpots = [];
let vehicleType = "pequenoCamion"; // "auto", "moto", o "pequenoCamion"
let currentFloor = 1;

// Fetch para traer los puestos ocupados desde el archivo PHP
fetch('ARCHIVO QUE TRAE OUESTOS OCUPADOS')
    .then(response => response.json())
    .then(data => {
        puestosOcupados = data;
        generateParkingLayout();
    })
    .catch(error => console.error('Error:', error));

function generateParkingLayout() {
    const container = document.getElementById('parkingContainer');
    container.innerHTML = ''; // borra el contendio existente

    if (vehicleType === "moto" && currentFloor === 2) {
        container.innerHTML = '<p class="text-center text-red-500">Las motos solo pueden estacionar en el primer piso.</p>';
        return;
    }

    if (vehicleType === "auto" || vehicleType === "pequenoCamion") {
        generateAutoTruckLayout(container);
    } else if (vehicleType === "moto" && currentFloor === 1) {
        generateMotoLayout(container);
    }
}

function generateAutoTruckLayout(container) {
    const prefix = currentFloor === 1 ? 'A' : 'C';
    const leftColumn = createParkingColumn(1, 20, prefix);
    const middleColumn = createParkingColumn(21, 30, prefix);
    const rightColumn = createParkingColumn(31, 50, prefix);

    container.appendChild(createDiv('flex justify-center gap-[150px] h-full', [
        createDiv('flex flex-col justify-start overflow-y-auto', [leftColumn]),
        createDiv('flex flex-col justify-end', [
            middleColumn,
            createDiv('w-[45px] h-[108px] border-t border-b border-l border-black')
        ]),
        createDiv('flex flex-col justify-start overflow-y-auto', [rightColumn])
    ]));
}

function generateMotoLayout(container) {
    const motoSpots = createParkingColumn(1, 20, 'B');
    container.appendChild(createDiv('flex', [
        createDiv('w-1/4', [motoSpots]),
        createDiv('w-3/4')
    ]));
}

function createParkingColumn(start, end, prefix) {
    const column = document.createElement('div');
    column.className = 'flex flex-col';
    for (let i = start; i <= end; i++) {
        column.appendChild(createParkingSpot(i, prefix));
    }
    return column;
}

function createParkingSpot(number, prefix) {
    const spotId = `${prefix}${number}`;
    const spot = document.createElement('button');
    spot.className = 'flex items-center justify-center border border-black m-0.5 cursor-pointer transition-colors w-14 h-10 hover:bg-gray-100';
    spot.innerHTML = `<div class="text-center text-black text-xs font-bold">${spotId}</div>`;
    spot.dataset.spot = spotId;
    spot.type = 'button';

    if (puestosOcupados.includes(spotId)) {
        spot.classList.add('bg-gray-500', 'text-white', 'cursor-not-allowed');
        spot.disabled = true;
    } else {
        spot.addEventListener('click', function(e) {
            e.preventDefault();
            if (vehicleType === "pequenoCamion") {
                handlePequenoCamionSpotSelection(this);
            } else {
                handleRegularSpotSelection(this);
            }
        });
    }

    return spot;
}

function handleRegularSpotSelection(spot) {
    selectedSpots.forEach(s => s.classList.remove('bg-[#5381c6]', 'text-white'));
    selectedSpots = [spot];
    spot.classList.add('bg-[#5381c6]', 'text-white');
}

function handlePequenoCamionSpotSelection(spot) {
    if (selectedSpots.length === 0) {
        // Primer spot seleccionado
        selectedSpots.push(spot);
        spot.classList.add('bg-[#5381c6]', 'text-white');
    } else if (selectedSpots.length === 1) {
        // Verificar si el nuevo spot es adyacente al spot ya seleccionado
        if (isAdjacentSpot(selectedSpots[0], spot)) {
            selectedSpots.push(spot);
            spot.classList.add('bg-[#5381c6]', 'text-white');
        } else {
            // Si no es adyacente, deseleccionar el spot anterior y seleccionar el nuevo
            selectedSpots[0].classList.remove('bg-[#5381c6]', 'text-white');
            selectedSpots = [spot];
            spot.classList.add('bg-[#5381c6]', 'text-white');
        }
    } else if (selectedSpots.length === 2) {
        // Si ya hay dos spots seleccionados, deseleccionar ambos y seleccionar el nuevo
        selectedSpots.forEach(s => s.classList.remove('bg-[#5381c6]', 'text-white'));
        selectedSpots = [spot];
        spot.classList.add('bg-[#5381c6]', 'text-white');
    }
}

function isAdjacentSpot(spot1, spot2) {
    const id1 = spot1.dataset.spot;
    const id2 = spot2.dataset.spot;
    
    // Extraer el prefijo osea letra y el número de cada spot
    const prefix1 = id1.charAt(0);
    const prefix2 = id2.charAt(0);
    const num1 = parseInt(id1.slice(1));
    const num2 = parseInt(id2.slice(1));
    
    // Verificar si los spots están en la misma columna y son números consecutivos
    return prefix1 === prefix2 && Math.abs(num1 - num2) === 1;
}

function createDiv(className, children = []) {
    const div = document.createElement('div');
    div.className = className;
    children.forEach(child => {
        if (child instanceof Node) {
            div.appendChild(child);
        }
    });
    return div;
}

document.getElementById('parkingForm').addEventListener('submit', function(e) {
    e.preventDefault();
    let output;
    if (vehicleType === "pequenoCamion") {
        output = selectedSpots.map(spot => spot.dataset.spot);
    } else {
        output = [selectedSpots.length > 0 ? selectedSpots[0].dataset.spot : null, null];
    }
    document.getElementById('selectedSpotsInput').value = JSON.stringify(output);
    this.submit();
});

function updateFloorDisplay() {
    document.getElementById('floorDisplay').textContent = `Piso ${currentFloor}`;
}

document.getElementById('decrementFloor').addEventListener('click', function() {
    if (currentFloor > 1) {
        currentFloor--;
        updateFloorDisplay();
        generateParkingLayout();
    }
});

document.getElementById('incrementFloor').addEventListener('click', function() {
    if (currentFloor < 2 && vehicleType !== "moto") {
        currentFloor++;
        updateFloorDisplay();
        generateParkingLayout();
    }
});

// inicia cuando cargan los elementos del DOM
document.addEventListener('DOMContentLoaded', function() {
    updateFloorDisplay();
    generateParkingLayout();
});
    </script>
</body>
    <footer class="w-screen bg-[#514e4e] ">      
    <div class="  text-white py-12 container mx-auto px-4">
        <div class="flex flex-col md:flex-row justify-between items-center">
            <div class="mb-8 md:mb-0">
                <img class="w-48 h-auto mb-6" src="{{ asset('img/AIO Negativo (1).png') }}" alt="AIO Logo" />
                <div class="space-y-4">
                    <div class="flex items-center">
                        <img class="w-8 h-8 mr-4" src="{{ asset('img/InstagramLogo.png') }}" alt="Instagram" />
                        <span class="text-lg font-bold   ">@Aiotalleres</span>
                    </div>
                    <div class="flex items-center">
                        <img class="w-8 h-8 mr-4" src="{{ asset('img/XLogo.png') }}" alt="Twitter" />
                        <span class="text-lg font-bold   ">@Aiotalleres</span>
                    </div>
                    <div class="flex items-center">
                        <img class="w-8 h-8 mr-4" src="{{ asset('img/TelefonoLogo.png') }}" alt="Teléfono" />
                        <span class="text-lg font-bold   ">+598 99 123 456</span>
                    </div>
                </div>
            </div>
            <div class="w-full md:w-1/2 h-64 md:h-72">
                <div id="mapContainer" class="w-full h-full rounded-lg"></div>
            </div>
        </div>
    </div>
          <script src="https://js.api.here.com/v3/3.1/mapsjs-core.js"></script>
    <script src="https://js.api.here.com/v3/3.1/mapsjs-service.js"></script>
    <script src="https://js.api.here.com/v3/3.1/mapsjs-ui.js"></script>
    <script src="https://js.api.here.com/v3/3.1/mapsjs-mapevents.js"></script>

    <script>
        // Inicializar el servicio de Here Maps
        const platform = new H.service.Platform({
            apikey: 'mPUawsT9Wo28yuY79gBvNN_j0lGCzX2uJE2WiQ0sKG0' // Asegúrate de que esta clave es válida
        });

        // Obtener las capas del mapa
        const defaultLayers = platform.createDefaultLayers();

        // Crear el mapa
        const map = new H.Map(
            document.getElementById('mapContainer'),
            defaultLayers.raster.normal.map, // Usar el mapa normal (vectorial)
            {
                zoom: 15,  // Nivel de zoom inicial
                center: { lat: -34.87290336184553, lng: -56.16794676768326 }  // Coordenadas
            }
        );

        // Habilitar la interacción del usuario (zoom, desplazamiento)
        const mapEvents = new H.mapevents.MapEvents(map);
        const behavior = new H.mapevents.Behavior(mapEvents);

        // Agregar controles de interfaz (zoom y otros)
        const ui = H.ui.UI.createDefault(map, defaultLayers);

        // Crear un marcador
        const marker = new H.map.Marker({ lat: -34.87290336184553, lng: -56.16794676768326 });
        map.addObject(marker); // Agregar el marcador al mapa

    </script>
      
     
    </footer>

</html>
